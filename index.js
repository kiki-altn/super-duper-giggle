const TelegramBot = require('node-telegram-bot-api');

// –¢–≤–æ–π —Ç–æ–∫–µ–Ω (–Ω–µ –∑–∞–±—É–¥—å –∫–∞–≤—ã—á–∫–∏!)
const token = '8588196537:AAH_G_POioS_ffg_CdZk6dxtNPhckcT8x7k'; // —Å—é–¥–∞ —Å–≤–æ–π —Ç–æ–∫–µ–Ω
// –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–≤–æ—é –∏–≥—Ä—É
const gameUrl = 'https://kiki-altn.github.io/super-duper-giggle/';

const bot = new TelegramBot(token, { polling: true });

// –ö–æ–º–∞–Ω–¥–∞ /start
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const firstName = msg.from.first_name || '–¥—Ä—É–≥';

  bot.sendMessage(chatId, 
    `üëã *–ü—Ä–∏–≤–µ—Ç, ${firstName}!*\n\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ *–ú–æ–±–∏–ª—å–Ω—ã–π –±–∞–Ω–∫* ‚Äî –∏–≥—Ä—É, –≥–¥–µ —Ç—ã –º–æ–∂–µ—à—å —Å—Ç–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω–µ—Ä–æ–º (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ, –Ω–æ –≤—Å—ë –∂–µ üòÑ).\n\nüëá –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä–∞—Ç—å!`,
    {
      parse_mode: 'Markdown',
      reply_markup: {
        inline_keyboard: [
          [{ text: 'üí∞ –ò–≥—Ä–∞—Ç—å –≤ –±–∞–Ω–∫', web_app: { url: gameUrl } }],
          [{ text: '‚ùì –ö–∞–∫ –∏–≥—Ä–∞—Ç—å', callback_data: 'howto' }]
        ]
      }
    }
  );
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏
bot.on('callback_query', (query) => {
  const chatId = query.message.chat.id;

  if (query.data === 'howto') {
    bot.sendMessage(chatId, 
      `üìñ *–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:*\n\n` +
      `1Ô∏è‚É£ –í–≤–µ–¥–∏ —Å—É–º–º—É –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞.\n` +
      `2Ô∏è‚É£ –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ: –ø–æ–ø–æ–ª–Ω–∏—Ç—å, —Å–Ω—è—Ç—å, –≤–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç –∏–ª–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.\n` +
      `3Ô∏è‚É£ –°–ª–µ–¥–∏ –∑–∞ –∫—É—Ä—Å–æ–º –≤–∞–ª—é—Ç –∏ –æ—Ç–∫—Ä—ã–≤–∞–π –¥–µ–ø–æ–∑–∏—Ç—ã!\n` +
      `4Ô∏è‚É£ –ù–∞–∂–∏–º–∞–π "–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏ –∏–∑–º–µ–Ω–∏—Ç—å –∫—É—Ä—Å.\n\n` +
      `üèÜ *–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è* —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.\n\n` +
      `–£–¥–∞—á–∏!`,
      { parse_mode: 'Markdown' }
    );
  }

  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å "—á–∞—Å–∏–∫–∏" –Ω–∞ –∫–Ω–æ–ø–∫–µ
  bot.answerCallbackQuery(query.id);
});

// –†–µ–∞–∫—Ü–∏—è –Ω–∞ –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–µ –∫–æ–º–∞–Ω–¥—ã)
bot.on('message', (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text ? msg.text.toLowerCase() : '';

  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã
  if (text.startsWith('/')) return;

  // –ú–∞—Å—Å–∏–≤ —Å–ª—É—á–∞–π–Ω—ã—Ö —Ñ—Ä–∞–∑
  const randomPhrases = [
    'ü§î –•–º, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ... –ê —Ç—ã —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ò–≥—Ä–∞—Ç—å"?',
    'üí∞ –°–µ–≥–æ–¥–Ω—è –≤—ã–≥–æ–¥–Ω—ã–π –∫—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞! –ó–∞–π–¥–∏ –≤ –∏–≥—Ä—É –∏ –ø—Ä–æ–≤–µ—Ä—å.',
    'üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ ‚Äî –¥–µ–ª–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–µ, –Ω–æ –≤ –∏–≥—Ä–µ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!',
    'üéÆ –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π /start',
    'üòÑ –Ø –ø—Ä–æ—Å—Ç–æ –±–æ—Ç, –Ω–æ –º–æ–≥—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–±—è –≤ –±–∞–Ω–∫!',
    'üè¶ –ö—Å—Ç–∞—Ç–∏, –≤ –∏–≥—Ä–µ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –¥–µ–ø–æ–∑–∏—Ç –ø–æ–¥ –ø—Ä–æ—Ü–µ–Ω—Ç—ã.',
    'üí∏ –ù–µ –±–µ—Ä–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî –ø–æ—Ç–æ–º —Å–ª–æ–∂–Ω–æ –æ—Ç–¥–∞–≤–∞—Ç—å!',
    'üöÄ –¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã–π–¥–µ—à—å.'
  ];

  // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
  if (text.includes('–ø—Ä–∏–≤–µ—Ç') || text.includes('–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π')) {
    bot.sendMessage(chatId, 'üëã –ò —Ç–µ–±–µ –ø—Ä–∏–≤–µ—Ç! –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ? –•–æ—á–µ—à—å —Å—ã–≥—Ä–∞—Ç—å?');
  }
  // –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –∫–∞–∫ –¥–µ–ª–∞
  else if (text.includes('–∫–∞–∫ –¥–µ–ª–∞')) {
    bot.sendMessage(chatId, '–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! –ñ–¥—É, –∫–æ–≥–¥–∞ —Ç—ã –∑–∞–ø—É—Å—Ç–∏—à—å –∏–≥—Ä—É üòâ');
  }
  // –ï—Å–ª–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è—Ç
  else if (text.includes('—Å–ø–∞—Å–∏–±–æ')) {
    bot.sendMessage(chatId, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –†–∞–¥ –ø–æ–º–æ—á—å üòä');
  }
  // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö ‚Äî —Å–ª—É—á–∞–π–Ω–∞—è —Ñ—Ä–∞–∑–∞
  else {
    const randomIndex = Math.floor(Math.random() * randomPhrases.length);
    bot.sendMessage(chatId, randomPhrases[randomIndex]);
  }
});

// –°–æ–æ–±—â–∞–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
console.log('–ë–æ—Ç –æ–∂–∏–ª –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!');